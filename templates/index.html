<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Classification Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Email Classification Dashboard</h1>
            <p class="subtitle">Analyze and compare Naive Bayes and SVM classification results</p>
        </header>
        
        <div class="dashboard">
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> Overall Accuracy</h2>
                <div class="metrics">
                    <div class="metric-box">
                        <div class="metric-title">Naive Bayes</div>
                        <div class="metric-value">{{ "%.0f"|format(nb_data.accuracy * 100) }}%</div>
                    </div>
                    <div class="metric-box svm">
                        <div class="metric-title">SVM</div>
                        <div class="metric-value">{{ "%.0f"|format(svm_data.accuracy * 100) }}%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="accuracyChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-balance-scale"></i> Macro Average F1-Score</h2>
                <div class="metrics">
                    <div class="metric-box">
                        <div class="metric-title">Naive Bayes</div>
                        <div class="metric-value">{{ "%.0f"|format(nb_data.macro_avg * 100) }}%</div>
                    </div>
                    <div class="metric-box svm">
                        <div class="metric-title">SVM</div>
                        <div class="metric-value">{{ "%.0f"|format(svm_data.macro_avg * 100) }}%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="f1Chart"></canvas>
                </div>
            </div>
            
            <div class="card card-full">
                <h2><i class="fas fa-percentage"></i> Detailed Classification Metrics</h2>
                <div class="tabs">
                    <div class="tab active" data-tab="nb">Naive Bayes</div>
                    <div class="tab" data-tab="svm">SVM</div>
                </div>
                
                <div class="tab-content active" id="nb-tab">
                    <div class="class-results">
                        <div>
                            <h3>Precision by Class</h3>
                            <div class="chart-container">
                                <canvas id="nbPrecisionChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3>Recall by Class</h3>
                            <div class="chart-container">
                                <canvas id="nbRecallChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="svm-tab">
                    <div class="class-results">
                        <div>
                            <h3>Precision by Class</h3>
                            <div class="chart-container">
                                <canvas id="svmPrecisionChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3>Recall by Class</h3>
                            <div class="chart-container">
                                <canvas id="svmRecallChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card card-full">
                <h2><i class="fas fa-envelope"></i> Test the Classification Models</h2>
                <p>Enter email text to see how each model classifies it:</p>
                
                <div class="test-area">
                    <div class="input-group">
                        <label for="email-text">Email Content:</label>
                        <textarea id="email-text" placeholder="Paste email content here...">Hello, we are offering a special discount on our products. Limited time offer!</textarea>
                    </div>
                    
                    <button class="btn" id="classify-btn"><i class="fas fa-play-circle"></i> Classify Email</button>
                    
                    <div class="results-display">
                        <h3>Classification Results:</h3>
                        <div class="result-item">
                            <span class="result-label">Naive Bayes Prediction:</span>
                            <span class="result-value promotion" id="nb-prediction">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">SVM Prediction:</span>
                            <span class="result-value promotion" id="svm-prediction">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Confidence (SVM):</span>
                            <span class="result-value" id="svm-confidence">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card card-full">
                <h2><i class="fas fa-table"></i> Model Comparison</h2>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Pass Flask data to JavaScript
        const nbData = {
            classes: {{ nb_data.classes | tojson }},
            precision: {{ nb_data.precision }},
            recall: {{ nb_data.recall }},
            f1: {{ nb_data.f1 }},
            accuracy: {{ nb_data.accuracy }},
            macro_avg: {{ nb_data.macro_avg }},
            weighted_avg: {{ nb_data.weighted_avg }}
        };
        
        const svmData = {
            classes: {{ svm_data.classes | tojson }},
            precision: {{ svm_data.precision }},
            recall: {{ svm_data.recall }},
            f1: {{ svm_data.f1 }},
            accuracy: {{ svm_data.accuracy }},
            macro_avg: {{ svm_data.macro_avg }},
            weighted_avg: {{ svm_data.weighted_avg }}
        };
        
        // Initialize charts when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initCharts(nbData, svmData);
            
            // Add event listener for the classify button
            document.getElementById('classify-btn').addEventListener('click', function() {
                const emailText = document.getElementById('email-text').value;
                
                fetch('/classify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'email_text=' + encodeURIComponent(emailText)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }
                    
                    // Update UI with results
                    document.getElementById('nb-prediction').textContent = data.nb_prediction;
                    document.getElementById('nb-prediction').className = `result-value ${data.nb_prediction.toLowerCase()}`;
                    
                    document.getElementById('svm-prediction').textContent = data.svm_prediction;
                    document.getElementById('svm-prediction').className = `result-value ${data.svm_prediction.toLowerCase()}`;
                    
                    document.getElementById('svm-confidence').textContent = `${(data.svm_confidence * 100).toFixed(0)}%`;
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while classifying the email.');
                });
            });
        });
    </script>
</body>
</html>